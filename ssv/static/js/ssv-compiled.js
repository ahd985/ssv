!function t(e,i,n){function r(o,s){if(!i[o]){if(!e[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=i[o]={exports:{}};e[o][0].call(d.exports,function(t){var i=e[o][1][t];return r(i?i:t)},d,d.exports,t,e,i,n)}return i[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t){return t>=1e3||t<.01?d3.format(".2e")(t):d3.format(".2f")(t)}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function(){function t(e,i,n,r){a(this,t),this.uuid=e,this.svg_selector="#"+this.uuid+" #ssv-svg",this.svg_div_selector="#"+this.uuid+" .ssv-visual",this.svg_zoom_selector="#"+this.uuid+" #zoom-container",this.svg_overlay_selector="#"+this.uuid+" #ssv-overlay",this.x_series=i,this.element_data=n,this.elements=[],this.controls={play_enabled:!1,pan_zoom_enabled:!0,slider_moving:!1,current_x:0,target_x:0,play_speed:1,max_speed:8,min_speed:1,speed_mult:2,play_selector:"#"+this.uuid+" #play-button",pan_zoom_selector:"#"+this.uuid+" #pan-zoom-button",slider_selector:"#"+this.uuid+" .range-slider",speed_selector:"#"+this.uuid+" #speed-button",x_val_selector:"#"+this.uuid+" #x-series-val",pause_icon_selector:"#"+this.uuid+" #pause-icon",play_icon_selector:"#"+this.uuid+" #play-icon",pan_zoom_enabled_icon_selector:"#"+this.uuid+" #pan-zoom-enabled-icon",pan_zoom_disabled_icon_selector:"#"+this.uuid+" #pan-zoom-disabled-icon"},this.svg_overlays=r,console.log("starting"),this.initialize_overlays(),console.log("overlays done"),this.set_font_scale(),console.log("set font scale"),this.initialize_controls(),console.log("set controls"),this.initialize_elements(),console.log("set elements"),this.initialize_pan_zoom(),console.log("set pan zoom")}return s(t,[{key:"initialize_overlays",value:function(){var t=d3.select(this.svg_selector);t.select("defs").empty()&&t.append("defs");for(var e in this.svg_overlays)t.select("defs").html(t.select("defs").html()+this.svg_overlays[e])}},{key:"set_font_scale",value:function(){var t=parseFloat(d3.select(this.svg_selector).attr("viewBox").split(" ")[3])/d3.select(this.svg_div_selector).node().getBoundingClientRect().height;this.font_scale=t,d3.select(this.svg_selector).attr("font-scale",t)}},{key:"initialize_elements",value:function(){for(var t in this.element_data)for(var e in this.element_data[t])e=this.element_data[t][e],"cell"==t?this.elements.push(new d(this.uuid,e.ids,e.description,e.conditions,e.report_id)):"line"==t?this.elements.push(new u(this.uuid,e.ids,e.description,e.conditions,e.report_id)):"heatmap"==t?this.elements.push(new p(this.uuid,e.ids,e.description,e.conditions,e.report_id)):"toggle"==t?this.elements.push(new h(this.uuid,e.ids,e.description,e.conditions,e.report_id)):"report"==t?this.elements.push(new _(this.uuid,e.ids,e.description,e.conditions,e.report_id)):"table"==t?this.elements.push(new f(this.uuid,e.ids,e.description,e.conditions,e.report_id)):"legend"==t&&this.elements.push(new y(this.uuid,e.ids,e.description,e.conditions,e.report_id));this.update_elements(0),delete this.element_data,this.elements.map(function(t){"conditions"in t&&delete t.conditions})}},{key:"update_elements",value:function(t){d3.select(this.controls.x_val_selector).html(o(this.x_series[t]));for(var e in this.elements)this.elements[e].update(t)}},{key:"render_slider",value:function(){var t=this,e=d3.select("#"+t.uuid+" .modebar").node().getBoundingClientRect(),i=e.height,n=2,r=8,a=e.width-d3.select("#"+t.uuid+" .modebar-group").node().getBoundingClientRect().width,o=d3.scaleLinear().domain([0,t.x_series.length-1]).range([0,a-2*(n+r)]).clamp(!0),s=d3.select("#"+t.uuid+" .modebar-slider");s.selectAll("svg").remove();var l=s.append("svg").attr("width",a).append("g").attr("transform","translate("+(r+n).toString()+","+(i/2+n).toString()+")");l.append("line").attr("class","slider-track").attr("x1",o.range()[0]).attr("x2",o.range()[1]).select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","slider-inset").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","slider-overlay").call(d3.drag().on("start.interrupt",function(){l.interrupt()}).on("start drag",function(){t.controls.target_x=Math.round(o.invert(d3.event.x)),t.move(),c.attr("cx",o(t.controls.target_x))}));var c=l.append("circle").attr("class","slider-handle").attr("r",r)}},{key:"play",value:function(){var t=this;t.controls.play_enabled?(t.controls.play_enabled=!1,d3.select(t.controls.pause_icon_selector).attr("style","display:none"),d3.select(t.controls.play_icon_selector).attr("style","")):(t.controls.play_enabled=!0,d3.select(t.controls.pause_icon_selector).attr("style",""),d3.select(t.controls.play_icon_selector).attr("style","display:none"),t.controls.current_x>=t.x_series.length-1&&(t.controls.current_x=0),t.x_series_forward())}},{key:"toggle_pan_zoom",value:function(){var t=this;t.controls.pan_zoom_enabled?(t.controls.pan_zoom_enabled=!1,d3.select(t.controls.pan_zoom_disabled_icon_selector).attr("style",""),d3.select(t.controls.pan_zoom_enabled_icon_selector).attr("style","display:none")):(t.controls.pan_zoom_enabled=!0,d3.select(t.controls.pan_zoom_disabled_icon_selector).attr("style","display:none"),d3.select(t.controls.pan_zoom_enabled_icon_selector).attr("style",""))}},{key:"move",value:function(){var t=this;t.controls.slider_moving||(t.controls.slider_moving=!0,t.controls.current_x=t.controls.target_x,t.update_elements(t.controls.current_x),d3.timer(function(){t.controls.slider_moving=!1},100))}},{key:"x_series_forward",value:function(){var t=this;window.setTimeout(function(){t.controls.play_enabled&&t.controls.current_x<t.x_series.length-1&&(t.controls.target_x=t.controls.current_x+1,t.move(),t.controls.current_x<t.x_series.length-1?t.x_series_forward():t.play())},1e3/this.controls.play_speed)}},{key:"initialize_controls",value:function(){var t=this;t.render_slider(),d3.select(window).on("resize",function(){t.render_slider}),d3.select(this.controls.play_selector).attr("ssv-id",this.uuid).on("click",function(){t.play()}),d3.select(this.controls.pan_zoom_selector).attr("ssv-id",this.uuid).on("click",function(){t.toggle_pan_zoom()}),d3.select(this.controls.speed_selector).attr("ssv-id",this.uuid).on("click",function(){var t=v[d3.select(this).attr("ssv-id")];t.controls.play_speed==t.controls.max_speed?t.controls.play_speed=t.controls.min_speed:t.controls.play_speed*=t.controls.speed_mult;var e=t.controls.play_speed.toString();d3.select(t.controls.speed_selector+" span").html("<b>"+e+"x</b>")})}},{key:"initialize_pan_zoom",value:function(){var t=d3.select(this.svg_selector);t.append("rect").attr("height","100%").attr("width","100%").style("fill","none");var e=t.attr("viewBox").split(" "),i=t.node().getBBox(),n=parseFloat(e[0]),r=parseFloat(e[2]),a=parseFloat(e[1]),o=parseFloat(e[3]),s=r-n,l=o-a,c=(d3.select(this.svg_div_selector).node().getBoundingClientRect(),d3.select(this.svg_overlay_selector).attr("y",i.y).attr("height",i.height).attr("x",i.x).attr("width",i.width),this),d=d3.zoom().scaleExtent([1,8]).on("zoom",function(){if(c.controls.pan_zoom_enabled){var t=d3.event.transform.k,e=Math.max(d3.event.transform.x,-(r*t-s)),e=Math.min(e,n),i=Math.max(d3.event.transform.y,-(o*t-l)),i=Math.min(i,a);d3.select(c.svg_zoom_selector).attr("transform","translate("+[e,i]+")scale("+t+")")}});d3.select(this.svg_overlay_selector).call(d)}}]),t}(),c=function(){function t(e,i,n,r,o){a(this,t),this.uuid=e,this.svg_selector="#"+this.uuid+" #ssv-svg",this.ids=i,this.selectors=[];for(var s in this.ids)this.selectors.push("#"+this.uuid+" #"+this.ids[s]);this.report_id=o,this.report_selector="#"+this.uuid+" #"+this.report_id,this.description=n,this.conditions=r,this.patterns_initialized=!1,this.report_initialized=!1,this.initialize_color_scales()}return s(t,[{key:"initialize_color_scales",value:function(){this.conditions.map(function(t){if("color_scale"in t&&"color_levels"in t){var e=t.color_scale,i=t.color_levels;t.color_scale=d3.scaleQuantile().domain([d3.min(i),d3.max(i)]).range(e)}})}},{key:"initialize_report",value:function(){var t=d3.select(this.report_selector),e=d3.select(t.node().parentNode);if(!t.empty()){var i=t.node().getBBox(),n=i.width,r=i.x,a=i.y,s=1.2,l=1,c=.1,d="#FFC107",u="#00BFA5",p="#FFFFFF",h="#FFFFFF",_="#FFEB3B",f="#616161",y="Sizing...";t.style("visibility","hidden");var v=d3.select(this.svg_selector).attr("font-scale"),m=e.append("g").attr("transform","translate("+r+","+a+")").append("g").attr("id","ssv-report").attr("font-size",v.toString()+"em"),g=m.append("rect").attr("width",n).attr("fill",f).attr("fill-opacity","1").attr("text-anchor","middle").attr("alignment-baseline","after-edge"),x=m.append("text").attr("width",n).attr("fill-opacity","1").attr("text-anchor","middle").attr("alignment-baseline","after-edge").attr("x",n/2).attr("fill",d).style("font-size",s.toString()+"em").text(y),b=x.node().getBBox().height;x.attr("y",b*(1+c));var z=b*l/s,w=b*(1+2*c);g.attr("height",w);var k=z*(1+1*c),F=k+z*c;x.text(this.description);for(var B=0;B<this.conditions.length;B++){var O=this.conditions[B];if("report"in O&&O.report){var A=O.data,S=1;A[0].constructor===Array&&(S=A[0].length),m.append("rect").attr("width",n).attr("fill",f).attr("fill-opacity","1").attr("text-anchor","middle").attr("alignment-baseline","after-edge").attr("y",w).attr("height",(S+1)*F),m.append("text").attr("width",n).attr("fill-opacity","1").attr("text-anchor","middle").attr("alignment-baseline","after-edge").attr("x",n/2).attr("y",w+k).attr("fill",u).style("font-size",l.toString()+"em").attr("font-style","oblique").text(O.description);var j;j="section_label"in O&&""!=O.section_label?O.section_label:"Section",w+=F;for(var N=0;N<S;N++){var C;C=S>1?3:2,S>1&&m.append("text").attr("width",n).attr("fill-opacity","1").attr("text-anchor","middle").attr("alignment-baseline","after-edge").attr("x",n/(2*C)).attr("y",w+k).attr("fill",p).style("font-size",l.toString()+"em").text(j+" #"+(N+1).toString());var M;M=S>1?A.map(function(t){return o(t[N])}):A.map(function(t){return o(t)}),m.append("text").attr("width",n).attr("fill-opacity","1").attr("text-anchor","middle").attr("alignment-baseline","after-edge").attr("class","value-text").datum(M).attr("x",n/(2*(4-C))).attr("y",w+k).attr("fill",_).style("font-size",l.toString()+"em"),m.append("text").attr("width",n).attr("fill-opacity","1").attr("text-anchor","middle").attr("alignment-baseline","after-edge").attr("x",(2*C-1)*n/(2*C)).attr("y",w+k).attr("fill",h).style("font-size",l.toString()+"em").text(O.unit),w+=F}}}}this.report_initialized=!0}},{key:"update_report",value:function(t){this.report_initialized||this.initialize_report();var e=d3.select(d3.select(this.report_selector).node().parentNode);e.selectAll(".value-text").text(function(e){return e[t]})}},{key:"initialize_pattern",value:function(t,e,i,n){var r=d3.select(this.svg_selector);r.select("defs").empty()&&r.append("defs");var a=t.getBBox().height;i[0].length>1&&(i=i.map(function(t){return t.sort(function(t,e){return-(t[0]-e[0])})}));var i=i.map(function(t){return t.map(function(t){var e=Math.max(0,1-t[0])*a;return[e].concat(t.slice(1,t.length))})}),o=d3.select("#"+this.uuid+" svg defs"),s=o.append("pattern").attr("id",e).attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("patternContentUnits","userSpaceOnUse").datum(i),l=s.selectAll().data(function(t){return t[0]}).enter();l.each(function(){s.append("rect").attr("id","base").attr("x","0").attr("width","100%").attr("height","100%"),s.append("rect").attr("id","transition").attr("x","0").attr("width","100%").attr("height","1px").attr("fill","#FFFFFF"),s.append("rect").attr("id","overlay").attr("x","0").attr("width","100%").attr("height","100%")});var c=d3.select(t);"fill"==n?c.style("fill","url(#"+e+")"):c.style("stroke","url(#"+e+")"),c.style("fill-opacity",1),c.style("opacity",1)}},{key:"update_pattern",value:function(t,e,i){var n=d3.select("#"+this.uuid+" #"+i);n.selectAll("#base").data(function(e){return e[t]}).transition().attr("y",function(t){return t[0]}).style("fill",function(t){return t[1]}).style("opacity",function(t){return t[2]}),n.selectAll("#transition").data(function(e){return e[t]}).transition().attr("y",function(t){return t[0]>0?t[0]:"-1%"}).style("opacity",function(t){return t[2]}),n.selectAll("#overlay").data(function(e){return e[t]}).transition().attr("fill",function(t){return null==t[3]?"none":"url(#"+t[3]+")"}).attr("y",function(t){return t[0]}).style("opacity",function(t){return t[2]})}}]),t}(),d=function(t){function e(t,i,r,o,s){return a(this,e),n(this,Object.getPrototypeOf(e).call(this,t,i,r,o,s))}return r(e,t),s(e,[{key:"update",value:function(t){var e=this;e.selectors.map(function(i,n){var r=d3.selectAll(i),a="pattern_"+e.ids[n];if(!e.patterns_initialized){var o=[];e.conditions.map(function(t){var e,i=1.01;if(e="overlay"in t?t.overlay:null,"background"==t.type)o.push(t.data.map(function(n){return[i,t.color_scale(n),t.opacity,e]}));else if("levelstatic"==t.type)o.push(t.data.map(function(i){var n=(Math.min((i-t.min_height)/(t.max_height-t.min_height)),1);return[n,t.color,t.opacity,e]}));else if("dynamiclevel"==t.type)o.push(t.data.map(function(i,n){var r=Math.min((i-t.min_height)/(t.max_height-t.min_height),1),a=t.color_scale(t.data_dynamic[n]);return[r,a,t.opacity,e]}));else if("logical"==t.type)o.push(t.data.map(function(n){var r;return r=n?t.true_color:t.false_color,[i,r,t.opacity,e]}));else if("zonaly"==t.type){var n=[];n=n.concat(t.data.map(function(i,n){return i.map(function(i,r){var a=Math.min((i-t.min_height)/(t.max_height-t.min_height),1),o=t.color_scale(t.data_dynamic[n][r]);return[a,o,t.opacity,e]})})),o=o.concat(d3.zip.apply(this,n))}}),o=d3.zip.apply(this,o),r.each(function(){e.initialize_pattern(this,a,o,"fill")})}r.each(function(){e.update_pattern(t,this,a)})}),e.patterns_initialized=!0,e.report_id&&e.update_report(t)}}]),e}(c),u=function(t){function e(t,i,r,o,s){return a(this,e),n(this,Object.getPrototypeOf(e).call(this,t,i,r,o,s))}return r(e,t),s(e,[{key:"update",value:function(t){var e=this;e.selectors.map(function(i,n){var r=d3.selectAll(i),a="pattern_"+e.ids[n],o=[];e.patterns_initialized||(e.conditions.map(function(t){var e,e=(t.opacity,null);if("equaly"==t.type){var i=[],i=i.concat(t.data.map(function(i){return i.map(function(n,r){var a=r/i.length,o=t.color_scale(n);return[a,o,t.opacity,e]})}));o=o.concat(d3.zip.apply(this,i))}}),o=d3.zip.apply(this,o),r.each(function(){e.initialize_pattern(this,a,o,"stroke")})),r.each(function(){e.update_pattern(t,this,a)})}),e.patterns_initialized=!0,e.report_id&&e.update_report(t)}}]),e}(c),p=function(t){function e(t,i,r,o,s){a(this,e);var l=n(this,Object.getPrototypeOf(e).call(this,t,i,r,o,s));return l.conditions[0].data[0].constructor==Array?l.conditions.num_sections=l.conditions[0].data[0].length:l.conditions[0].num_sections=1,l.initialize(),l}return r(e,t),s(e,[{key:"initialize",value:function(){var t=this.conditions[0].data[0],e=this;e.selectors.map(function(i){var n=d3.select(i),r=d3.select(n.node().parentNode),a=n.node().getBBox(),o=d3.scaleLinear().domain([0,t[0].length]).range([0,a.width]),s=d3.scaleLinear().domain([0,t.length]).range([0,a.height]),l=r.append("g").attr("transform","translate("+a.x+","+a.y+")").append("g"),c=e.conditions[0].color_scale,d=e.conditions[0].data.map(function(t){return t.map(function(t){return t.map(function(t){return c(t)})})});l.data([d]);var u=l.selectAll().data(function(t){return t[0]}).enter().append("g").attr("class","x_section").attr("stroke","black").attr("stroke-width","1px");u.selectAll(".bin").data(function(t){return t}).enter().append("rect").attr("class","bin").attr("x",function(t,e){return o(e)}).attr("width",function(t,e){return o(e+1)-o(e)}).style("fill",function(t){return t}).style("fill-opacity",function(t){return e.conditions[0].opacity}).attr("height",a.height/t.length),u.each(function(t,e){d3.select(this).selectAll(".bin").attr("y",s(e))})})}},{key:"update",value:function(t){var e=this;e.selectors.map(function(e){var i=d3.select(e),n=d3.select(i.node().parentNode),r=n.select("g").select("g"),a=r.selectAll(".x_section").data(function(e){return e[t]});a.selectAll(".bin").data(function(t){return t}).transition().style("fill",function(t){return t})}),e.report_id&&e.update_report(t)}}]),e}(c),h=function(t){function e(t,i,r,o,s){a(this,e);var l=n(this,Object.getPrototypeOf(e).call(this,t,i,r,o,s));return l.data_initialized=!1,l}return r(e,t),s(e,[{key:"update",value:function(t){var e=this;e.selectors.map(function(i){var n=d3.selectAll(i);e.data_initialized||"showhide"==e.conditions[0].type&&n.datum(e.conditions[0].data);var r=n.datum();r[t]||r[t]>0?n.transition().attr("opacity",1):n.transition().attr("opacity",0)}),e.data_initialized=!0,e.report_id&&e.update_report(t)}}]),e}(c),_=function(t){function e(t,i,r,o,s){return a(this,e),n(this,Object.getPrototypeOf(e).call(this,t,i,r,o,s))}return r(e,t),s(e,[{key:"update",value:function(t){this.report_id&&this.update_report(t)}}]),e}(c),f=function(t){function e(t,i,r,o,s){return a(this,e),n(this,Object.getPrototypeOf(e).call(this,t,i,r,o,s))}return r(e,t),s(e,[{key:"initialize_report",value:function(){var t=d3.select(this.report_selector),e=d3.select(t.node().parentNode);if(!t.empty()){var i=t.node().getBBox(),n=i.width,r=i.x,a=i.y,o="table_"+this.report_id;t.style("visibility","hidden");var s=d3.select(this.svg_selector).attr("font-scale"),l=e.append("g").attr("transform","translate("+r+","+a+")").append("foreignObject").attr("id","ssv-table").attr("width",n).attr("height",500).append("xhtml:table").attr("class","table").attr("id",o).datum(this.conditions[0].data);l.append("thead").append("tr").selectAll().data(this.conditions[0].headers).enter().append("th").text(function(t){return t}).style("font-size",s.toString()+"em")}l.append("tbody"),this.report_initialized=!0}},{key:"update_report",value:function(t){this.report_initialized||this.initialize_report();var e="table_"+this.report_id,i=d3.select(this.svg_selector).attr("font-scale"),n=d3.select("#"+this.uuid+" #"+e+" tbody"),r=n.selectAll(".content-row").data(function(e){return e[t]});r.exit().remove(),r.enter().append("tr").merge(r).attr("class","content-row");var a=n.selectAll(".content-row").selectAll(".content-cell").data(function(t){return t});a.exit().remove(),a.enter().append("td").merge(a).text(function(t){return t}).style("font-size",i.toString()+"em").attr("class","content-cell")}},{key:"update",value:function(t){this.report_id&&this.update_report(t)}}]),e}(c),y=function(t){function e(t,i,r,o,s){return a(this,e),n(this,Object.getPrototypeOf(e).call(this,t,i,r,o,s))}return r(e,t),s(e,[{key:"initialize_report",value:function(){var t=d3.select(this.report_selector),e=d3.select(t.node().parentNode),i=d3.select(this.svg_selector).attr("font-scale");if(!t.empty()){t.style("visibility","hidden");var n=t.node().getBBox(),r=n.width,a=n.x,o=n.y,e=d3.select(t.node().parentNode),s=e.append("g").attr("transform","translate("+a+","+o+")").append("g").attr("font-size",i+"em").attr("stroke","black").attr("stroke-width","0.01em"),l=this.conditions[0].color_scale,c=l.range().length,d=d3.scaleLinear().domain([0,c]).range([0,r]),u=1.5,p=1,h=.1,_=s.append("text").text(this.description).attr("x",r/2).attr("y","1em").attr("text-anchor","middle").attr("font-size",u.toString()+"em"),f=_.node().getBBox().height,y=s.selectAll("rect").data(l.range());y.enter().append("rect").attr("x",function(t,e){return d(e)}).attr("y",(1+h)*f).attr("width",function(t,e){return d(e+1)-d(e)}).attr("height",f).attr("fill",function(t){return t}).style("fill-opacity",this.conditions[0].opacity).attr("font-size",u.toString()+"em"),y.enter().append("text").text(function(t){return l.invertExtent(t)[0].toFixed(0)}).attr("x",function(t,e){return d(e)}).attr("y",f*(2+h+p/u*(1+h))).attr("text-anchor","middle").attr("font-size",p.toString()+"em")}this.report_initialized=!0}},{key:"update_report",value:function(t){this.report_initialized||this.initialize_report()}},{key:"update",value:function(t){this.report_id&&this.update_report(t)}}]),e}(c);window.onerror=function(t){d3.select("body").attr("JSError",t)};var v={};e.exports={add_element_context:function(t,e,i,n){v[t]=new l(t,e,i,n)}}},{}]},{},[1]);
//# sourceMappingURL=maps/ssv-compiled.js.map
